/*************************************************************************
 * Copyright (c) 2017 by the mfmg authors                                *
 * All rights reserved.                                                  *
 *                                                                       *
 * This file is part of the mfmg libary. mfmg is distributed under a BSD *
 * 3-clause license. For the licensing terms see the LICENSE file in the *
 * top-level directory                                                   *
 *                                                                       *
 * SPDX-License-Identifier: BSD-3-Clause                                 *
 *************************************************************************/

#define BOOST_TEST_MODULE agglomerate

#include "main.cc"

#include <mfmg/amge.hpp>

#include <deal.II/distributed/tria.h>
#include <deal.II/dofs/dof_accessor.h>
#include <deal.II/fe/fe_q.h>
#include <deal.II/grid/grid_generator.h>
#include <deal.II/lac/trilinos_vector.h>

#include <array>
#include <boost/mpi.hpp>

template <int dim>
std::vector<unsigned int> test(boost::mpi::communicator world)
{
  dealii::parallel::distributed::Triangulation<dim> triangulation(world);
  dealii::FE_Q<dim> fe(1);
  dealii::DoFHandler<dim> dof_handler(triangulation);

  dealii::GridGenerator::hyper_cube(triangulation);
  triangulation.refine_global(3);
  dof_handler.distribute_dofs(fe);

  mfmg::AMGe<dim, dealii::TrilinosWrappers::MPI::Vector> amge(world,
                                                              dof_handler);

  std::array<unsigned int, dim> agglomerate_dim;
  for (unsigned int i = 0; i < dim; ++i)
    agglomerate_dim[i] = i + 2;
  amge.build_agglomerates(agglomerate_dim);

  std::vector<unsigned int> agglomerates;
  for (auto cell : dof_handler.active_cell_iterators())
    agglomerates.push_back(cell->user_index());

  return agglomerates;
}

BOOST_AUTO_TEST_CASE(simple_agglomerate_2d)
{
  boost::mpi::communicator world;
  std::vector<unsigned int> agglomerates = test<2>(world);

  std::vector<unsigned int> ref_agglomerates;
  if (world.size() == 1)
    ref_agglomerates = {{1, 1, 1, 1, 2,  2,  2,  2,  1,  1,  3,  3, 2,
                         2, 4, 4, 5, 5,  5,  5,  6,  6,  6,  6,  5, 5,
                         7, 7, 6, 6, 8,  8,  3,  3,  3,  3,  4,  4, 4,
                         4, 9, 9, 9, 9,  10, 10, 10, 10, 7,  7,  7, 7,
                         8, 8, 8, 8, 11, 11, 11, 11, 12, 12, 12, 12}};
  if (world.size() == 2)
  {
    if (world.rank() == 0)
      ref_agglomerates = {{0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 3, 3, 2, 2,
                           4, 4, 5, 5, 5, 5, 6, 6, 6, 6, 5, 5, 7, 7, 6, 6, 8, 8,
                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    else
      ref_agglomerates = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                           0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 3, 3, 2, 2, 4, 4,
                           5, 5, 5, 5, 6, 6, 6, 6, 5, 5, 7, 7, 6, 6, 8, 8}};
  }
  if (world.size() == 4)
  {
    if (world.rank() == 0)
      ref_agglomerates = {{0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2,
                           1, 1, 3, 3, 2, 2, 4, 4, 0, 0, 0, 0, 0, 0, 0,
                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    if (world.rank() == 1)
      ref_agglomerates = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                           1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 3, 3, 2, 2, 4,
                           4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    if (world.rank() == 2)
      ref_agglomerates = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                           0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 1, 1, 3,
                           3, 2, 2, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0}};

    if (world.rank() == 3)
      ref_agglomerates = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1,
                           1, 2, 2, 2, 2, 1, 1, 3, 3, 2, 2, 4, 4}};
  }

  BOOST_TEST(agglomerates == ref_agglomerates);
}

BOOST_AUTO_TEST_CASE(simple_agglomerate_3d)
{
  boost::mpi::communicator world;

  std::vector<unsigned int> agglomerates = test<3>(world);
  std::vector<unsigned int> ref_agglomerates;
  if (world.size() == 1)
  {
    ref_agglomerates = {
        {1,  1,  1,  1,  1,  1,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,
         3,  3,  1,  1,  3,  3,  2,  2,  4,  4,  2,  2,  4,  4,  1,  1,  1,  1,
         1,  1,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  3,  3,  1,  1,
         3,  3,  2,  2,  4,  4,  2,  2,  4,  4,  5,  5,  5,  5,  5,  5,  5,  5,
         6,  6,  6,  6,  6,  6,  6,  6,  5,  5,  7,  7,  5,  5,  7,  7,  6,  6,
         8,  8,  6,  6,  8,  8,  5,  5,  5,  5,  5,  5,  5,  5,  6,  6,  6,  6,
         6,  6,  6,  6,  5,  5,  7,  7,  5,  5,  7,  7,  6,  6,  8,  8,  6,  6,
         8,  8,  3,  3,  3,  3,  3,  3,  3,  3,  4,  4,  4,  4,  4,  4,  4,  4,
         9,  9,  9,  9,  9,  9,  9,  9,  10, 10, 10, 10, 10, 10, 10, 10, 3,  3,
         3,  3,  3,  3,  3,  3,  4,  4,  4,  4,  4,  4,  4,  4,  9,  9,  9,  9,
         9,  9,  9,  9,  10, 10, 10, 10, 10, 10, 10, 10, 7,  7,  7,  7,  7,  7,
         7,  7,  8,  8,  8,  8,  8,  8,  8,  8,  11, 11, 11, 11, 11, 11, 11, 11,
         12, 12, 12, 12, 12, 12, 12, 12, 7,  7,  7,  7,  7,  7,  7,  7,  8,  8,
         8,  8,  8,  8,  8,  8,  11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12,
         12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14,
         14, 14, 13, 13, 15, 15, 13, 13, 15, 15, 14, 14, 16, 16, 14, 14, 16, 16,
         13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 13, 13,
         15, 15, 13, 13, 15, 15, 14, 14, 16, 16, 14, 14, 16, 16, 17, 17, 17, 17,
         17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 17, 17, 19, 19, 17, 17,
         19, 19, 18, 18, 20, 20, 18, 18, 20, 20, 17, 17, 17, 17, 17, 17, 17, 17,
         18, 18, 18, 18, 18, 18, 18, 18, 17, 17, 19, 19, 17, 17, 19, 19, 18, 18,
         20, 20, 18, 18, 20, 20, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16,
         16, 16, 16, 16, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22,
         22, 22, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16,
         21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 19, 19,
         19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 23, 23, 23, 23,
         23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 19, 19, 19, 19, 19, 19,
         19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 23, 23, 23, 23, 23, 23, 23, 23,
         24, 24, 24, 24, 24, 24, 24, 24}};
  }
  if (world.size() == 2)
  {
    if (world.rank() == 0)
      ref_agglomerates = {
          {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,
           1,  1,  1,  1,  1,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,
           3,  3,  1,  1,  3,  3,  2,  2,  4,  4,  2,  2,  4,  4,  1,  1,  1,
           1,  1,  1,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  3,  3,
           1,  1,  3,  3,  2,  2,  4,  4,  2,  2,  4,  4,  5,  5,  5,  5,  5,
           5,  5,  5,  6,  6,  6,  6,  6,  6,  6,  6,  5,  5,  7,  7,  5,  5,
           7,  7,  6,  6,  8,  8,  6,  6,  8,  8,  5,  5,  5,  5,  5,  5,  5,
           5,  6,  6,  6,  6,  6,  6,  6,  6,  5,  5,  7,  7,  5,  5,  7,  7,
           6,  6,  8,  8,  6,  6,  8,  8,  3,  3,  3,  3,  3,  3,  3,  3,  4,
           4,  4,  4,  4,  4,  4,  4,  9,  9,  9,  9,  9,  9,  9,  9,  10, 10,
           10, 10, 10, 10, 10, 10, 3,  3,  3,  3,  3,  3,  3,  3,  4,  4,  4,
           4,  4,  4,  4,  4,  9,  9,  9,  9,  9,  9,  9,  9,  10, 10, 10, 10,
           10, 10, 10, 10, 7,  7,  7,  7,  7,  7,  7,  7,  8,  8,  8,  8,  8,
           8,  8,  8,  11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12,
           12, 12, 7,  7,  7,  7,  7,  7,  7,  7,  8,  8,  8,  8,  8,  8,  8,
           8,  11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0}};
    else
      ref_agglomerates = {
          {0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
           0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  2,
           2,  2,  2,  2,  2,  2,  2,  1,  1,  3,  3,  1,  1,  3,  3,  2,  2,
           4,  4,  2,  2,  4,  4,  1,  1,  1,  1,  1,  1,  1,  1,  2,  2,  2,
           2,  2,  2,  2,  2,  1,  1,  3,  3,  1,  1,  3,  3,  2,  2,  4,  4,
           2,  2,  4,  4,  5,  5,  5,  5,  5,  5,  5,  5,  6,  6,  6,  6,  6,
           6,  6,  6,  5,  5,  7,  7,  5,  5,  7,  7,  6,  6,  8,  8,  6,  6,
           8,  8,  5,  5,  5,  5,  5,  5,  5,  5,  6,  6,  6,  6,  6,  6,  6,
           6,  5,  5,  7,  7,  5,  5,  7,  7,  6,  6,  8,  8,  6,  6,  8,  8,
           3,  3,  3,  3,  3,  3,  3,  3,  4,  4,  4,  4,  4,  4,  4,  4,  9,
           9,  9,  9,  9,  9,  9,  9,  10, 10, 10, 10, 10, 10, 10, 10, 3,  3,
           3,  3,  3,  3,  3,  3,  4,  4,  4,  4,  4,  4,  4,  4,  9,  9,  9,
           9,  9,  9,  9,  9,  10, 10, 10, 10, 10, 10, 10, 10, 7,  7,  7,  7,
           7,  7,  7,  7,  8,  8,  8,  8,  8,  8,  8,  8,  11, 11, 11, 11, 11,
           11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 7,  7,  7,  7,  7,  7,
           7,  7,  8,  8,  8,  8,  8,  8,  8,  8,  11, 11, 11, 11, 11, 11, 11,
           11, 12, 12, 12, 12, 12, 12, 12, 12}};
  }
  if (world.size() == 4)
  {
    if (world.rank() == 0)
      ref_agglomerates = {
          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1,
           3, 3, 1, 1, 3, 3, 2, 2, 4, 4, 2, 2, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 2,
           2, 2, 2, 2, 2, 2, 2, 1, 1, 3, 3, 1, 1, 3, 3, 2, 2, 4, 4, 2, 2, 4, 4,
           5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 7, 7, 5, 5, 7,
           7, 6, 6, 8, 8, 6, 6, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6,
           6, 6, 5, 5, 7, 7, 5, 5, 7, 7, 6, 6, 8, 8, 6, 6, 8, 8, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    if (world.rank() == 1)
      ref_agglomerates = {
          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 3, 3, 1, 1, 3,
           3, 2, 2, 4, 4, 2, 2, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2,
           2, 2, 1, 1, 3, 3, 1, 1, 3, 3, 2, 2, 4, 4, 2, 2, 4, 4, 5, 5, 5, 5, 5,
           5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 7, 7, 5, 5, 7, 7, 6, 6, 8, 8,
           6, 6, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 7,
           7, 5, 5, 7, 7, 6, 6, 8, 8, 6, 6, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    if (world.rank() == 2)
      ref_agglomerates = {
          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2,
           2, 2, 1, 1, 3, 3, 1, 1, 3, 3, 2, 2, 4, 4, 2, 2, 4, 4, 1, 1, 1, 1, 1,
           1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 3, 3, 1, 1, 3, 3, 2, 2, 4, 4,
           2, 2, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 7,
           7, 5, 5, 7, 7, 6, 6, 8, 8, 6, 6, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6,
           6, 6, 6, 6, 6, 6, 5, 5, 7, 7, 5, 5, 7, 7, 6, 6, 8, 8, 6, 6, 8, 8, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
    if (world.rank() == 3)
      ref_agglomerates = {
          {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
           0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 3,
           3, 1, 1, 3, 3, 2, 2, 4, 4, 2, 2, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
           2, 2, 2, 2, 2, 2, 1, 1, 3, 3, 1, 1, 3, 3, 2, 2, 4, 4, 2, 2, 4, 4, 5,
           5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 7, 7, 5, 5, 7, 7,
           6, 6, 8, 8, 6, 6, 8, 8, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6,
           6, 5, 5, 7, 7, 5, 5, 7, 7, 6, 6, 8, 8, 6, 6, 8, 8}};
  }

  BOOST_TEST(agglomerates == ref_agglomerates);
}
